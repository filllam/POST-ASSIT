<!-- 主容器 -->
<main class="min-h-screen p-4 sm:p-6 lg:p-8 font-sans bg-slate-900 text-slate-100">
  <div class="max-w-7xl mx-auto">
    <!-- 頁首 -->
    <header class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight text-white">{{ uiText().title }}</h1>
      <p class="mt-3 text-lg text-slate-400 max-w-2xl mx-auto">{{ uiText().subtitle }}</p>
      
      <!-- UI 語言切換器 -->
      <div class="mt-6 flex justify-center items-center gap-2 flex-wrap">
        @for (lang of uiLanguages; track lang.code) {
          <button 
            (click)="setUiLanguage(lang.code)"
            [class.bg-sky-500]="language() === lang.code"
            [class.text-white]="language() === lang.code"
            [class.bg-slate-700]="language() !== lang.code"
            [class.hover:bg-slate-600]="language() !== lang.code"
            class="px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200">
            {{ lang.name }}
          </button>
        }
      </div>
    </header>

    <!-- 主要內容網格 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
      
      <!-- 左欄：控制項 -->
      <div class="flex flex-col gap-6 p-6 bg-slate-800 rounded-2xl shadow-lg">
        <h2 class="text-2xl font-bold text-white border-b border-slate-700 pb-3">{{ uiText().uploadHeader }}</h2>
        
        <!-- 圖片上傳區域 -->
        <div 
          (click)="triggerFileInput()" 
          class="relative aspect-video w-full bg-slate-700/50 rounded-lg flex items-center justify-center border-2 border-dashed border-slate-600 hover:border-sky-500 transition-colors duration-200 cursor-pointer overflow-hidden">
          @if (uploadedImage(); as image) {
            <img [src]="image" alt="Uploaded image for post generation" class="w-full h-full object-cover">
          } @else {
            <div class="text-center text-slate-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
              <p class="mt-2">{{ uiText().uploadPlaceholder }}</p>
            </div>
          }
          <input type="file" id="fileInput" (change)="onFileSelected($event)" hidden accept="image/*" />
        </div>

        <!-- 圖片控制按鈕 -->
        @if (uploadedImage(); as image) {
          <div class="grid grid-cols-2 gap-4">
            <button (click)="triggerFileInput()" class="w-full text-center bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200">{{ uiText().changeImage }}</button>
            <a [href]="image" download="post-image.png" class="w-full text-center bg-sky-600 hover:bg-sky-500 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200">{{ uiText().downloadImage }}</a>
          </div>
        }

        <!-- 貼文選項 -->
        <div class="flex flex-col gap-4">
          <div>
            <label for="post-language" class="block text-sm font-medium text-slate-300 mb-1">{{ uiText().postLanguage }}</label>
            <select id="post-language" (change)="setPostLanguage($any($event.target).value)" [value]="postLanguage()" class="w-full bg-slate-700 border border-slate-600 rounded-md p-2 text-white focus:ring-sky-500 focus:border-sky-500">
              @for (lang of postLanguages; track lang.code) {
                <option [value]="lang.code" class="bg-slate-800 text-white">{{ lang.name }}</option>
              }
            </select>
          </div>
          <div>
            <label for="mood" class="block text-sm font-medium text-slate-300 mb-1">{{ uiText().mood }}</label>
            <select id="mood" (change)="setMood($any($event.target).value)" [value]="selectedMood()" class="w-full bg-slate-700 border border-slate-600 rounded-md p-2 text-white focus:ring-sky-500 focus:border-sky-500">
              @for (mood of moodOptions; track mood.key) {
                <option [value]="mood.key" class="bg-slate-800 text-white">{{ uiText()[mood.nameKey] }}</option>
              }
            </select>
          </div>
          <div>
            <label for="tone" class="block text-sm font-medium text-slate-300 mb-1">{{ uiText().tone }}</label>
            <select id="tone" (change)="setTone($any($event.target).value)" [value]="selectedTone()" class="w-full bg-slate-700 border border-slate-600 rounded-md p-2 text-white focus:ring-sky-500 focus:border-sky-500">
              @for (tone of toneOptions; track tone.key) {
                <option [value]="tone.key" class="bg-slate-800 text-white">{{ uiText()[tone.nameKey] }}</option>
              }
            </select>
          </div>
        </div>

        <!-- 生成按鈕 -->
        <button 
          (click)="generatePost()" 
          [disabled]="!uploadedFile() || isLoading()"
          class="w-full bg-sky-600 text-white font-bold py-3 px-4 rounded-md transition-colors duration-200 disabled:bg-slate-600 disabled:cursor-not-allowed hover:bg-sky-500 flex items-center justify-center">
          @if (isLoading()) {
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <span>{{ uiText().loading }}</span>
          } @else {
            <span>{{ uiText().generatePost }}</span>
          }
        </button>
      </div>

      <!-- 右欄：輸出 -->
      <div class="flex flex-col p-6 bg-slate-800 rounded-2xl shadow-lg">
        <h2 class="text-2xl font-bold text-white border-b border-slate-700 pb-3 mb-4">{{ uiText().postHeader }}</h2>
        <div class="flex-grow min-h-[300px] bg-slate-900/50 rounded-lg p-4 prose prose-invert max-w-none prose-p:text-slate-300 prose-p:leading-relaxed overflow-y-auto">
          @if (isLoading()) {
            <div class="flex items-center justify-center h-full">
                <p class="text-slate-400">{{ uiText().loading }}</p>
            </div>
          } @else if (error(); as errorMessage) {
            <div class="text-red-400">
              <h3 class="font-bold text-red-300">{{ uiText().errorTitle }}</h3>
              <p>{{ errorMessage }}</p>
            </div>
          } @else if (generatedPost(); as post) {
            <p>{{ post }}</p>
          } @else {
            <div class="flex items-center justify-center h-full">
              <p class="text-slate-400">{{ uiText().postPlaceholder }}</p>
            </div>
          }
        </div>
        
        <!-- 操作按鈕 -->
        @if (generatedPost() && !isLoading()) {
          <div class="mt-4 flex flex-col gap-4">
            <!-- 朗讀按鈕 -->
            <button 
              (click)="toggleSpeech()"
              class="w-full flex items-center justify-center gap-2 text-center bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200">
              @if (isSpeaking()) {
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                <span>{{ uiText().stopReading }}</span>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" /></svg>
                <span>{{ uiText().readPost }}</span>
              }
            </button>
            
            <!-- 複製與分享 -->
            <div class="flex items-center gap-4">
                <button (click)="copyPost()" class="flex-1 w-full text-center bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200">
                  {{ isCopied() ? uiText().copied : uiText().copyPost }}
                </button>
                @if (isWebShareSupported) {
                    <button (click)="share()" class="flex-1 w-full text-center bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200">
                      {{ uiText().share }}
                    </button>
                }
            </div>

            <!-- 不支援 Web Share API 時的備用分享選項 -->
            @if (!isWebShareSupported) {
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-center text-xs">
                <a [href]="shareOnXLink()" target="_blank" class="bg-slate-700 hover:bg-slate-600 p-2 rounded-md transition-colors">{{ uiText().shareOnX }}</a>
                <a [href]="shareOnFacebookLink()" target="_blank" class="bg-slate-700 hover:bg-slate-600 p-2 rounded-md transition-colors">{{ uiText().shareOnFacebook }}</a>
                <a [href]="shareOnThreadsLink()" target="_blank" class="bg-slate-700 hover:bg-slate-600 p-2 rounded-md transition-colors">{{ uiText().shareOnThreads }}</a>
                <button (click)="shareOnInstagram()" class="bg-slate-700 hover:bg-slate-600 p-2 rounded-md transition-colors">{{ uiText().shareOnInstagram }}</button>
              </div>
            }
          </div>
        }
      </div>
    </div>
  </div>
</main>